# **UNIDAD 5:** PAR√ÅMETROS DE RED

### Links externos de esta unidad:

- üìä [Diapositivas de la Unidad 5](http://jamj2000.github.io/despliegueaplicacionesweb/5/diapositivas)
- üìö [Actividades de la Unidad 5](http://jamj2000.github.io/despliegueaplicacionesweb/5/actividades)

---

## √çndice

- Introducci√≥n
- DNS: Conceptos
- DNS: Tipos de servidores
- DNS: Resoluci√≥n de nombres
- DNS: Bind9

---

## 1Ô∏è‚É£ - Introducci√≥n

### 1.1 - En esta Unidad aprenderemos a

- Describir la estructura, nomenclatura y funcionalidad de los sistemas de nombres jer√°rquicos.
- Identificar las necesidades de configuraci√≥n del servidor de nombres en funci√≥n de los requerimientos de ejecuci√≥n de las aplicaciones Web desplegadas.
- Identificar la funci√≥n, elementos y estructuras l√≥gicas del servicio de directorio.
- Elaborar documentaci√≥n relativa a las adaptaciones realizadas en los servicios de red.

## 2Ô∏è‚É£ - DNS: Conceptos

- DNS (Domain Name System, sistema de nombres de dominio)
- Traduce nombres de equipos a direcciones IP y viceversa.
  - Nombre <----> Direcci√≥n IP.
  - P. ej: www.google.es <----> 172.217.17.3
- Hace uso de una **base de datos distribuida** con informaci√≥n sobre equipos (hosts).
- En los inicios de internet la informaci√≥n estaba centralizada.
  - Para ello se utilizaba un archivo **HOST.TXT**.
  - Estaba alojado en el Stanford Research Institute.
- [Informaci√≥n sobre el archivo hosts en Wikipedia](https://es.wikipedia.org/wiki/Archivo_hosts)

### 2.1 - FQDN

- Fully Qualified Host/Domain Name (FQHN/FQDN) "nombre completo" de un equipo.
- Formado por el **hostname**, seguido de un punto y su correspondiente nombre de **dominio**.
  - Por ejemplo, www.google.es.
  - **www** es el hostname.
  - **google.es** es el dominio.

**√Årbol DNS**
![√Årbol DNS](assets/dns-tree.png)

**Niveles DNS**
![Niveles DNS](assets/dns-niveles.png)

### 2.2 - Dominios de nivel superior

**gTLD - Generic Top Level Domains**

- Dominios originales. P. ej: **.com**, **.org**, **.net**, ...
- Nuevos dominios. P. ej: **.bar**, **.blog**, **.download**, ...

**sTLD - Sponsored Top Level Domains**

- Dominios patrocinados por determinados colectivos.
- P. ej: **.cat**, **.museum**, **.aero**, ...

**ccTLD -Country Code Top Level Domains**

- Dominios asociados a un pa√≠s.
- P. ej: **.es**, **.fr**, **.cn**, **.io**, ...

**Lista de TLD**

- [Lista de TLD en Wikipedia](https://en.wikipedia.org/wiki/List_of_Internet_top-level_domains)
- [Lista actualizada de todos los TLD](https://www.iana.org/domains/root/db)

### 2.3 - Servidores ra√≠z

- Tambi√©n llamados TNS (Top Name Servers).
- Son 13 en total. Pero tienen varias replicas
- Se conocen como A, B, C, D, E, F, G, H, I, J, K, L y M.
- Todos tienen la misma informaci√≥n.
- Se reparten el trabajo de resoluci√≥n.
- Cada uno es una copia de seguridad del resto.

[Root Servers](http://www.root-servers.org/)

---

## 3Ô∏è‚É£ - DNS: Tipos de servidores

- Servidor primario (maestro)
- Servidor secundario (esclavo)
- Servidor cach√©
- Servidor de reenv√≠o

### 3.1 - Servidor primario (maestro)

- Tiene autoridad sobre una zona.
- Obtiene la informaci√≥n de sus zonas de sus archivos locales.
- Todas las modificaciones sobre una zona se llevan a cabo en el servidor primario.
- No necesita reenviar la consulta.

![Servidor primario](assets/dns-primary.png)

### 3.2 - Servidor secundario (esclavo)

- Tiene informaci√≥n (s√≥lo lectura) sobre algunas zonas.
- Estos datos son copias de los servidores maestros.
- Cuando cambia la informaci√≥n en un servidor maestro, el esclavo la copia simplemente para actualizarse.
- S√≥lo atiende a peticiones de los clientes (resolvedores).

![Servidor secundario](assets/dns-secondary.png)

### 3.3 - Servidor cach√©

- No tiene autoridad sobre ninguna zona.
- En principio (cuando arranca) no es capaz de hacer ninguna resoluci√≥n por si mismo.
- Cuando recibe una consulta, la reenv√≠a a servidores que puedan resolverla y cuando le responden, almacena la respuesta en memoria.

![Servidor cach√©](assets/dns-cache.png)

### 3.4 - Servidor de reenv√≠o

- No posee autoridad sobre las zonas que resuelve.
- Cuando reciben una consulta, la reenv√≠an a los servidores que tienen configurados esperando que √©stos la resuelvan.

![Servidor de reenvio](assets/dns-reenvio.png)

---

## 4Ô∏è‚É£ - DNS: Resoluci√≥n de nombres

**Procedimiento**
![Resoluci√≥n DNS](assets/dns-resolucion.png)

**Tipos de resoluciones**

- **Resoluci√≥n directa**: Nombre --> IP
- **Resoluci√≥n inversa**: IP --> Nombre

**Utilidades para consultas DNS**

- **nslookup**
- **host**
- **dig**

### 4.1 - DIG

#### Ejemplos de uso

**Resoluci√≥n directa**

```bash
# Consulta registro A
dig  @8.8.8.8  www.google.es

# Consulta cualquier registro
dig  @8.8.8.8  -t ANY   google.es
```

**Resoluci√≥n inversa**

```bash
# Consulta registro PTR
dig  @8.8.8.8  -x 172.217.17.3
```

---

## 5Ô∏è‚É£ - DNS: Bind9

Software usado en los servidores DNS. Versi√≥n 9.

**`apt install bind9`**

### 5.1 - Gesti√≥n del servicio

```bash
systemctl  start   bind9  # service bind9 start
systemctl  restart bind9  # service bind9 restart
systemctl  stop    bind9  # service bind9 stop
systemctl  status  bind9  # service bind9 status

systemctl  enable  bind9  # Inicia bind9 con el sistema
systemctl  disable bind9  # Deshabilita bind9 del inicio del sistema
```

### 5.2 - Configuraci√≥n

**Directorios y Archivos**

- **`/etc/bind`**: Archivos principales
  - **`named.conf`** : fichero principal.
  - **`named.conf.options`** : opciones gen√©ricas.
  - **`named.conf.local`** : especificaci√≥n local.
- **`/var/lib/bind`**: Archivos de zonas primarias.
  - **`db.example.com`**: ejemplo de zona directa
  - **`db.172.16`**: ejemplo de zona inversa
- **`/var/cache/bind`**: Archivos de zonas secundarias.

---

### named.conf.local

**Ejemplo**

```
zone "example.com" {
  type master;
  file "/var/lib/bind/db.example.com";
};

zone "16.172.in-addr.arpa" {
  type master;
  file "/var/lib/bind/db.172.16";
};
```

---

### named.conf.options

**Ejemplo**

```
    forwarders {
                8.8.8.8;
                8.8.4.4;
         };
```

---

### Registros de recursos (RR)

- **A** = Address ‚Üí correspondencia nombre - IPv4
- **AAAA** ‚Üí correspondencia nombre - IPv6.
- **CNAME** = Canonical name ‚Üí alias o apodo para nombre.
- **MX** = Mail Exchanger ‚Üí servidores de correo del dominio.
- **NS** = Name Server ‚Üí servidores de nombres oficiales del dominio.
- **PTR** = PoinTeR ‚Üí correspondencia IP - nombre.
- **SOA** = Start Of Authority ‚Üí autoridad sobre el dominio de nombres.

---

### db.example.com

**Ejemplo de zona directa**

```
$ORIGIN example.com.
$TTL 1d

@          SOA  ns1  admin  (
           1  ; serial
           6h ; refresh
           1h ; retry
           1w ; expire
           6h ; nxdomain
)

           NS ns1
           NS ns2

ns1        A  172.16.0.101
ns2        A  172.16.0.102
pc01       A  172.16.0.201
pc02       A  172.16.0.202
```

---

### db.172.16

**Ejemplo de zona inversa**

```
$ORIGIN 16.172.in-addr.arpa.
$TTL 1d

@          SOA  ns1.example.com.  admin.example.com. (
           1  ; serial
           6h ; refresh
           1h ; retry
           1w ; expire
           6h ; nxdomain
)

           NS ns1.example.com.
           NS ns2.example.com.

101.0      PTR ns1.example.com.
102.0      PTR ns2.example.com.
201.0      PTR pc01.example.com.
202.0      PTR pc02.example.com.
```

---

### 5.3 - Herramientas de comprobaci√≥n

```
named-checkconf  -z
named-checkzone  example.com  /var/lib/bind/db.example.com
named-checkzone  16.172.in-addr.arpa  /var/lib/bind/db.172.16
```

![named checkconf checkzone](assets/named-checkconf-checkzone.png)
